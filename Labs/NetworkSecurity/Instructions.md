# Lab 8: Web Security

For this lab, we present you with Bananama, a hot new Node.js application that is unfortunately riddled with security holes. Your job is to find and exploit as many of these vulnerabilities as you can. Follow the instructions in the README.md file to install and run the server.
For the first portion of the lab, you should avoid looking at the source code, and try to attack the system as a black box. After you have made some attempts, go look at the source and audit it for vulnerabilities you did not find in the first portion.

## Instructions

1. Access the app in your browser. Observe that there's a comment box at the bottom of the main page, a “sign in” form in the header, and a separate “sign up” page.

2. Find as many vulnerabilities as you can. This application suffers from **four** separate vulnerabilities. None are dependent on any others—that is, you don't need to exploit any vulnerability as a prerequisite for exploiting another. These include a cross-site scripting (XSS) vulnerability, an SQL injection vulnerability, and a cross-site request forgery (CSRF) vulnerability.

   - Part 1: Spend 25 minutes trying to find the vulnerabilities without looking at the source code.
    
   - Part 2: After about 25 minutes, you can have a look at the source to see if you can find the vulnerabilities to exploit.
    
3.  Prepare the deliverable for this lab:

    - For each vulnerability you found, list the type of vulnerability, how you would exploit it, and how you would fix it.     

    - If you didn't find any vulnerabilities, that's okay! Web security can be tough if you have never before been exposed to it. In this case, write a paragraph detailing exactly what you tried to exploit the system, and what responses the system gave to these attempts.
    

## Hints

### Vulnerability 1, Cross-Site Request Forgery (CSRF)

A user can be tricked into making [`GET` or `POST` requests](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)#Examples) on completely separate websites. `GET` requests are particularly easy to forge because they can be disguised as links or fake images. For example if the user clicks on the link below, they will presumably transfer $100000 to Maria's account. Alternatively, if the image below is loaded, the same request would be made, without a direct user action.

```
<a href="http://bank.com/transfer.do?acct=MARIA&amount=100000">View my Pictures!</a>

<img src="http://bank.com/transfer.do?acct=MARIA&amount=100000" width="0" height="0" border="0">
```

Look for a way to change the state of the user's application through request forgery, even if it's a very simple change.


### Vulnerability 2, Client Side Validation

Client side input [validation](https://www.owasp.org/index.php/Data_Validation) is easy to bypass. One way to bypass is by editing the DOM.


### Vulnerability 3, XSS

[XSS attacks](https://www.owasp.org/index.php/Testing_for_Cross_site_scripting#Description_of_the_Issue) involve injecting code into the browser in some way. Content that is generated by input from the user is susceptible to XSS attacks.


### Vulnerability 4, SQL Injection

This is a more difficult vulnerability because it combines not only SQL injection, but also requires some knowledge of the hashing that the app uses.

First, notice the schema for user data,

```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  username TEXT NOT NULL,
  password TEXT NOT NULL,
  is_admin INTEGER DEFAULT 0
);
```

With some digging, you can see how the `password` is stored (note, not talking about "TEXT NOT NULL") by the app.

By the way, below is how to make a hash of a string (for example 'bacon') using [bcrypt-nodejs](https://www.npmjs.com/package/bcrypt-nodejs). Run `node` on the command line, then import the module, and make your hash.

Note that the `bcrypt` module must be installed first. If not already installed, `cd` into a directory where you want the `node_modules` to be and run `npm install bcryptjs`.

```javascript
$ node
> var bc = require('bcryptjs');
undefined
> bc.hashSync('bacon', 10);
'$2a$10$hj34IKU3UK5Fdglhs7wfwOqDhgaHXgHSWHKw1.rE3iP2fYuV5UYUq'
> 
```



## Advanced (Optional)

Try fixing the vulnerabilities, and include the fixes in your pull request.

## Credits
Jeff Wintersinger wrote the original lab and Nishant Arora and Nigel Fong made some improvements.


